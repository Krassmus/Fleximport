# HisInOne Import mit Fleximport

HisInOne ist ein großes deutsches Campus-Management-System, das oft in Kombination mit Stud.IP verwendet wird. Ein großes Projekt ist es gewesen, ein HisInOne über Fleximport mit Stud.IP zu koppeln. Das ist möglich, aber es ist auch viel zu konfigurieren. Daher gibt es hier eine Anleitung dazu.

## Installation

1. Installation von Fleximport im Stud.IP. Das Plugin muss mindestens den Root-Usern in Stud.IP zugänglich sein. Der Import ist ab Stud.IP 4.5 getestet und sollte für neuere Versionen von Stud.IP funktionieren. Fleximport selbst gibt es für ältere Stud.IPs auch und vermutlich wird das meiste auch für 4.0 aufwärts funktionsfähig sein. Aber es können trotzdem Teile des Imports wie die Modulstrukturen für ältere Stud.IP-Versionen schwierig bis unmöglich sein.
2. In HisInOne muss ein Zusatzservice zur Orchestrierung der Webservices von HisInOne installiert und einsatzfähig sein.
3. Als Root in Stud.IP angemeldet, geht man zum Fleximport (zum Beispiel über die Startseite im Schnellzugriff ganz unten, Fleximport kann aber auch so konfiguriert sein, dass er in der Kopfzeile auftaucht).
4. In der Sidebar klickt man auf *"Prozess importieren"*. Hier muss eine Datei mit der Endung `.flxip` importiert werden. Für HisInOne haben wir da schon mal etwas vorbereitet: [HisInOne Import.flxip](examples/HisInOneImport.flxip) . Die Datei kann [hier](examples/HisInOneImport.flxip) heruntergeladen werden oder sie befindet sich auch im Pluginverzeichnis von Fleximport im Ordner examples.
5. Jetzt klickt man auf *"Prozess bearbeiten"* in der Sidebar. Dort kann man den Prozess / Reiter in Fleximport umbenennen. Aber wichtiger ist es, dass man dort unter Konfigurationen den Wert für `HISINONE_TERMKEY` setzt, der für das Semester gilt, das man importieren will. Das sind die IDs der Semester in HisInOne wie 202101 für das Sommersemester 2021. Die ersten vier Stellen sind das Jahr, an dem das Semester anfängt. Dahinter gibt es noch eine 1 für das Sommersemester und eine 0 für das Wintersemester. In diesem Dialog kann man auch einzelne Tabellen deaktivieren, falls man zum Beispiel die Modulstrukturen nicht importiert haben möchte. Aber wir gehen erst einmal davon aus, dass das volle Programm gewünscht ist. Nicht vergessen, auf *Speichern* zu klicken!
6. Jetzt kommt noch die Verknüpfung zwischen HisInOne und Stud.IP. Dazu klickt man auf den Reiter *Konfiguration*. Auf dieser Seite kann man etliche Konfigurationsvariablen setzen, die für den Fleximport in irgendeiner Weise relevant sind. Ganz wichtig und relevant sind auf jeden Fall die Zugangsdaten zu den Webservices von HisInOne, damit Fleximport sich die Daten der Veranstaltungen und Personen und dem ganzen Rest abholen kann. Wichtig ist dabei der Wert `HISINONE_WSDL_URL`, der eine URL zu einer WSDL-Datei von HisInOne und in der Form `https://hisinone.MEINEHOCHSCHULEPLATZHALTER.de/qisserver/services2/StudIPService?wsdl` sein sollte. Diese URL muss nicht im ganzen Internet aber auf jeden Fall vom Stud.IP aus gesehen erreichbar sein. Am Ende dieser Datei gibt es eine Angabe zur `Location` (`<soap:address location="eine url">`). An dieser Stelle ist es sinnvoll sicherzugehen, dass die dort angebene URL ebenfalls vom Stud.IP-Server aus aufgerufen werden kann. Angaben wie `http://localhost/...` sind mit Sicherheit nicht korrekt.
7. Weitere Angaben sind der Nutzername und der Passwort des virtuellen Nutzers, der auf die Webservices von HisInOne zugreifen darf. Haben Sie noch keinen derartigen Nutzer, müssen Sie zuerst einen in HisInOne anlegen. In dem Reiter Konfiguration von Fleximport trägt man diesen Nutzernamen und Passwort ein als `HISINONE_SOAP_USERNAME` und `HISINONE_SOAP_PASSWORD`.
8. Als letzte der absolut wichtigen Angaben muss hier der `HISINONE_SOAP_ENDPOINT` gesetzt werden als eine URL in der Art `https://hisinone.MEINEHOCHSCHULEPLATZHALTER.de/qisserver/services2/`.

Ab jetzt sollte die Verbindung zwischen Stud.IP und HisInOne funktionieren. Um das zu testen, geht man zurück auf den Reiter *"HisInOne Import"* (bzw. wie man den Prozess genannt hat, den man zuvor importiert hat). Und dort klickt man in der Sidebar oder ganz unten auf der Seite auf den Button *"Daten abrufen"*. Das kann etwas dauern. Um genau zu sein, kann es sogar sehr lange dauern. Eine Stunde ist nicht ungewöhnlich, aber es kann auch mehr oder weniger dauern. Eventuell zeigt der Fleximport auch einen Statusbalken an, der den Fortschritt des Datenabrufens anzeigt. Aber Fleximport kann nur grob den Fortschritt messen. Es ist eher ein ungefährer Hinweis darauf, wieviele Kaffees man sich voraussichtlich kochen kann, bis die Daten da sind.

Wenn dies hier so lange dauert, dass es zu einem Timeout kommt, kann man im Reiter *"Konfiguration"* einen neuen Wert `MAXIMUM_EXECUTION_TIME` eintragen mit dem Wert 7200, was zwei Stunden entspricht. `MAXIMUM_EXECUTION_TIME` ist immer eine Zahl, die angibt, wie viele Sekunden der Import maximal dauern kann. Falls dennoch ein Timeout kommt (und vor dem Ablauf der angegebenen zwei Stunden), müsste man den Webserver wie Apache oder NGINX (bzw. PHP oder einen vorgeschalteten Proxy) so konfigurieren, dass Timeouts grundsätzlich durchaus lang sein können. Es gibt sehr viele Stellen in der Serverinfrastruktur, bei denen sich ein Timeout noch verstecken könnte.
